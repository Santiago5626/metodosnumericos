  <!DOCTYPE html>
  <html lang="es">
  <head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>M√©todos Num√©ricos</title>

  <!-- Tailwind -->
  <script src="https://cdn.tailwindcss.com"></script>

  <!-- Chart.js -->
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

  <!-- Icons -->
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.css">

  <!-- MathJax for LaTeX -->
  <script>
  window.MathJax = {
    tex: {
      inlineMath: [['$', '$'], ['\\(', '\\)']]
    },
    svg: { fontCache: 'global' }
  };
  </script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-svg.js" async></script>

  <style>
    .page { display:none; animation:fade .35s ease }
    .page.active { display:block }
    @keyframes fade { from{opacity:0} to{opacity:1} }
    .keybtn{ padding:.5rem .75rem; background:#f1f5f9; border-radius:.5rem; cursor:pointer; font-size:.9rem; text-align:center }
    .keybtn:hover{ background:#e2e8f0 }
    pre.math { background:#f8fafc; padding:8px; border-radius:6px; font-size:0.95rem; overflow:auto }
    #tutorial-overlay { pointer-events: none; }
    #tutorial-highlight { pointer-events: none; }
    #tutorial-textbox { pointer-events: auto; }
    #tutorialModal > div { height: 90vh; display: flex; flex-direction: column; }
    #tutorialContent { overflow-y: auto; flex: 1; }
    @keyframes pulse-border {
      0%, 100% { box-shadow: 0 0 0 0 rgba(59, 130, 246, 0.7); }
      50% { box-shadow: 0 0 0 12px rgba(59, 130, 246, 0); }
    }
    .tour-highlight {
      outline: 3px solid #3b82f6;
      outline-offset: 3px;
      border-radius: 6px;
      transition: outline .2s;
    }
    .animate-pulse-border { animation: pulse-border 2s infinite; }
  </style>
  </head>
  <body class="bg-gray-100 font-sans">

  <!-- HEADER -->
  <header class="bg-slate-800 text-white p-4 flex justify-between items-center shadow">
    <h1 class="font-bold text-lg flex items-center gap-2"><i class="bi bi-calculator"></i> M√©todos Num√©ricos</h1>
    <div class="flex items-center gap-4">
      <nav class="hidden md:flex gap-3">
        <button class="nav-btn px-2 py-1" data-page="sec-inicio">Inicio</button>
        <button class="nav-btn px-2 py-1" data-page="sec-teoria">Teor√≠a</button>
        <button class="nav-btn px-2 py-1" data-page="sec-caso-deriv">Caso Derivadas</button>
        <button class="nav-btn px-2 py-1" data-page="sec-caso-int">Caso Integraci√≥n</button>
        <button class="nav-btn px-2 py-1" data-page="sec-recursos">Recursos</button>
      </nav>
      <button id="menuBtn" class="md:hidden text-2xl"><i class="bi bi-list"></i></button>
    </div>
  </header>

  <!-- MOBILE MENU -->
  <nav id="menuMobile" class="hidden bg-slate-900 text-white flex-col p-3 md:hidden gap-1">
    <button class="nav-btn text-left py-2 w-full" data-page="sec-inicio">Inicio</button>
    <button class="nav-btn text-left py-2 w-full" data-page="sec-teoria">Teor√≠a</button>
    <button class="nav-btn text-left py-2 w-full" data-page="sec-caso-deriv">Caso Derivadas</button>
    <button class="nav-btn text-left py-2 w-full" data-page="sec-caso-int">Caso Integraci√≥n</button>
    <button class="nav-btn text-left py-2 w-full" data-page="sec-recursos">Recursos</button>
  </nav>

  <section id="sec-teoria" class="page max-w-4xl mx-auto p-4">
    <h2 class="text-2xl font-semibold mb-4">Diferenciaci√≥n Num√©rica</h2>

  <!-- ===================== TEOR√çA ===================== -->
  <div class="bg-white p-4 rounded shadow mb-6">
      <h3 class="font-semibold mb-2">Concepto</h3>
      <p class="text-sm text-gray-700">
        La <strong>derivaci√≥n num√©rica</strong> es una t√©cnica empleada para aproximar la derivada de una funci√≥n 
        cuando esta no se conoce de forma anal√≠tica o sus datos solo est√°n disponibles en puntos discretos.
      </p>

      <ul class="list-disc list-inside text-sm text-gray-700 mt-2">
        <li>Funciones sin f√≥rmula expl√≠cita</li>
        <li>Modelos experimentales y registros de sensores</li>
        <li>C√°lculos complejos o costosos</li>
        <li>Sistemas discretos en ingenier√≠a</li>
      </ul>
  </div>

  <div class="bg-white p-4 rounded shadow mb-6">

      <h3 class="font-semibold mb-2">Definici√≥n Formal</h3>
      <p class="text-sm text-gray-700">
        La derivada de una funci√≥n se define como el l√≠mite:
      </p>
      <p class="text-sm text-gray-700">
        $$
        f'(x) = \lim_{h \to 0} \frac{f(x+h) - f(x)}{h}
        $$
      </p>

      <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
        <div>
          <h3 class="font-semibold mb-2">Aproximaciones por Diferencias Finitas</h3>

          <p class="text-sm text-gray-700 font-medium mt-2">Diferencia hacia adelante (Forward):</p>
          <p class="text-sm text-gray-700">
            $$
            f'(x) \approx \frac{f(x+h) - f(x)}{h}
            $$
          </p>

          <p class="text-sm text-gray-700 font-medium mt-2">Diferencia hacia atr√°s (Backward):</p>
          <p class="text-sm text-gray-700">
            $$
            f'(x) \approx \frac{f(x) - f(x-h)}{h}
            $$
          </p>

          <p class="text-sm text-gray-700 font-medium mt-2">Diferencia centrada (Central):</p>
          <p class="text-sm text-gray-700">
            $$
            f'(x) \approx \frac{f(x+h) - f(x-h)}{2h}
            $$
          </p>

          <p class="text-xs text-gray-600 mt-2">
            La f√≥rmula centrada es m√°s precisa:  \( O(h^2) \) vs \( O(h) \) para las dem√°s.
          </p>
        </div>

      </div>
  </div>
  
  <div class="bg-white p-4 rounded shadow mb-6">
      <h3 class="font-semibold mb-2">Importancia</h3>
      <p class="text-sm text-gray-700">
        Permite estudiar tasas de cambio cuando solo se cuenta con datos discretos.
        Fundamental en optimizaci√≥n, simulaci√≥n, an√°lisis cient√≠fico e ingenier√≠a.
      </p>
  </div>
  
  <div class="grid md:grid-cols-2 gap-4 mb-6">
    <div class="bg-white p-4 rounded shadow">
      <h3 class="font-semibold mt-3">Caracter√≠sticas</h3>
      <ul class="list-disc list-inside text-sm text-gray-700">
        <li>Aproxima derivadas reales</li>
        <li>Uso de puntos separados por paso h</li>
        <li>Basada en diferencias finitas</li>
        <li>Error disminuye al reducir h</li>
        <li>Implementaci√≥n sencilla en software</li>
      </ul>
    </div>
    <div class="bg-white p-4 rounded shadow">
      <h3 class="font-semibold mt-3">Aplicaciones</h3>
      <ul class="list-disc list-inside text-sm text-gray-700">
        <li>Control y automatizaci√≥n industrial</li>
        <li>An√°lisis de se√±ales y sensores</li>
        <li>Finanzas y estimaci√≥n de riesgo</li>
        <li>Aprendizaje autom√°tico (gradiente)</li>
      </ul>
    </div>
  </div>
  
  <div class="grid md:grid-cols-2 gap-4 mb-6">
    <div class="bg-white p-4 rounded shadow">
      <h3 class="font-semibold mt-3">Ventajas</h3>
      <ul class="list-disc list-inside text-sm text-gray-700"><li>F√°cil implementaci√≥n</li><li>√ötil con datos experimentales</li></ul>
    </div>
    <div class="bg-white p-4 rounded shadow">
      <h3 class="font-semibold mt-3">Desventajas</h3>
      <ul class="list-disc list-inside text-sm text-gray-700"><li>Sensible al tama√±o de paso h</li><li>Afectada por ruido en los datos</li><li>No adecuada para discontinuidades bruscas</li></ul>
    </div>
  </div>

  <h2 class="text-2xl font-semibold mb-4 mt-8">Integraci√≥n Num√©rica</h2>

  <!-- Contenedor principal para toda la teor√≠a -->
  <div class="mb-6">
    <!-- ===================== TEOR√çA GENERAL ===================== -->
    <div class="bg-white p-4 rounded shadow leading-relaxed text-gray-800 mb-6">
      <h3 class="text-xl font-semibold mb-2">¬øQu√© es la integraci√≥n num√©rica?</h3>      
      <p>
        La integraci√≥n num√©rica es un conjunto de m√©todos utilizados para calcular
        el √°rea bajo una curva de forma aproximada, cuando no es posible obtener
        la integral exacta anal√≠ticamente.
      </p>

      <!-- Infograf√≠a movida aqu√≠ -->
      <div class="flex justify-center my-6">
        <img src="imagen-integracion.jpeg" alt="imagen de Integraci√≥n Num√©rica" class="rounded shadow-md w-full md:w-1/3">
      </div>

      <h3 class="text-lg font-semibold mt-4">¬øCu√°ndo se utiliza?</h3>
      <ul class="list-disc ml-6">
        <li>Cuando la funci√≥n no tiene una f√≥rmula conocida o es complicada de integrar.</li>
        <li>Cuando hay casos donde se obtienen valores experimentales (Xn, Yn), y no hay una funci√≥n exacta.</li>
      </ul>
      <h3 class="text-lg font-semibold mt-4">Importancia en ingenier√≠a</h3>
      <p>
        Permite obtener resultados para √°reas, fuerzas, energ√≠a, calor, consumo energ√©tico
        y muchos procesos f√≠sicos usando datos reales o funciones complejas.
      </p>
      <h3 class="text-lg font-semibold mt-4">Ventajas</h3>
      <ul class="list-disc ml-6">
        <li>Funciona con funciones complejas o sin expresi√≥n exacta.</li>
        <li>√ötil con datos medidos en puntos discretos.</li>
        <li>M√©todos sencillos como el trapecio o Simpson.</li>
        <li>Mayor precisi√≥n con m√°s puntos.</li>
      </ul>
      <h3 class="text-lg font-semibold mt-4">Desventajas</h3>
      <ul class="list-disc ml-6 mb-4">
        <li>Es una aproximaci√≥n.</li>
        <li>Pierde precisi√≥n si la funci√≥n cambia bruscamente.</li>
        <li>M√°s precisi√≥n requiere m√°s c√°lculos.</li>
        <li>Funci√≥n debe ser continua.</li>
      </ul>
    </div>

    <!-- ===================== REGLA DEL TRAPECIO ===================== -->
    <div class="bg-white p-4 rounded shadow">
        <h3 class="text-xl font-semibold mb-2">Regla del Trapecio</h3>
        <img src="Imagen-trapecio.png" alt="Ilustraci√≥n de la Regla del Trapecio" class="w-1/2 md:w-1/3 rounded shadow-md float-right ml-4">
        <p>Aproxima el √°rea bajo la curva usando trapecios. Reemplaza la curva por l√≠neas rectas entre puntos conocidos.</p>
        <p class="mt-2 font-semibold">F√≥rmula general:</p>
        <p class="math">\[ \int_a^b f(x)\,dx \approx \frac{h}{2} \left[f(x_0) + 2 \sum_{i=1}^{n-1} f(x_i) + f(x_n)\right] \]</p>
        <p class="font-semibold mt-2">Donde:</p>
        <ul class="list-disc ml-6">
          <li>\(h = \frac{b-a}{n}\)</li>
          <li>\(x_0, x_1, \ldots, x_n\) son los puntos del intervalo</li>
          <li>Se suman los valores intermedios multiplicados por 2</li>
        </ul>
        
        <!-- ===================== EJEMPLO  ===================== -->
        <div class="bg-gray-50 p-4 rounded shadow my-6 border border-gray-200">
          <h3 class="text-xl font-semibold mb-2">Ejemplo aplicado</h3>
        
          <p>Consideremos la integral:</p>
          <p class="math">\[ \int_0^6 (x^2 + 1) \,dx \]</p>
        
          <p>Intervalo:</p>
          <p class="math">\[ a = 0,\quad b = 6,\quad n = 6 \]</p>
        
          <p>Calculamos \(h\):</p>
          <p class="math">\[
            h = \frac{6 - 0}{6} = 1
          \]</p>
        
          <p>Completamos la tabla:</p>
        
          <table class="table-auto border w-full text-center">
            <tr><td class="math">\( f(x_0)=f(a)=f(0)=1 \)</td></tr>
            <tr><td class="math">\( f(x_1)=f(a+h)=f(0+1)=f(1) \)</td></tr>
            <tr><td class="math">\( f(x_2)=f(a+2h)=f(0+2)=f(2) \)</td></tr>
            <tr><td class="math">\( f(x_3)=f(a+3h)=f(0+3)=f(3) \)</td></tr>
            <tr><td class="math">\( f(x_4)=f(a+4h)=f(0+4)=f(4) \)</td></tr>
            <tr><td class="math">\( f(x_5)=f(a+5h)=f(0+5)=f(5) \)</td></tr>
            <tr><td class="math">\( f(x_6)=f(b)=f(6) \)</td></tr>
          </table>
        
          <br>
        
          <p>La √∫ltima columna se halla reemplazando el valor que nos da ‚Äúx‚Äù en la tercera columna en la funci√≥n:</p>
        
          <p class="math">\[
            e^{-x^2}
          \]</p>
        
          <p>El siguiente paso es hallar el √°rea total con la f√≥rmula:</p>
        
          <p class="math">\[
          \frac{h}{2} \left[\, f(x_0) + 2\sum_{i=1}^{n-1} f(x_0 + ih) + f(x_n) \,\right]
          \]</p>
        
          <p>
            Esto se resume en sumar todos los t√©rminos de la mitad, multiplicarlos por 2 y agregar
            \(f(x_0)\) y \(f(x_n)\), obteniendo:
          </p>
        
          <p class="math">\[
            A_T = \frac{1}{2}
                  \left[
                    1 + 2(2.13136) + 0.01832
                  \right]
          \]</p>
        
          <p class="math">\[
            A_T = \frac{5.28104}{6} \approx 0.88017333
          \]</p>
        
          <p class="font-bold text-green-700">Resultado final: \(A_T \approx 0.88017\)</p>
        </div>
    </div>
  </div>
</section>

<section id="sec-caso-deriv" class="page max-w-4xl mx-auto p-4">
  <!-- ================= CASO DE ESTUDIO ================= -->
  <div class="mb-6">
    <div class="bg-white p-4 rounded shadow mb-6">

  <h3 class="font-semibold mb-2">Caso de Estudio: Producci√≥n de Botellas</h3>
  <p class="text-sm text-gray-700">
    En una planta de bebidas se mide la producci√≥n acumulada para estimar la tasa de producci√≥n
    (botellas/minuto) utilizando diferencias finitas.
  </p>

  <p class="font-medium text-sm mt-2 text-gray-700">Datos discretos observados:</p>
  <p class="text-xs text-gray-700">P(t) = [0, 480, 1020, 1570, 2100, 2610, 3100]</p>
  <p class="text-xs text-gray-700">t (min)= [0, 10, 20, 30, 40, 50, 60]</p>


  <h4 class="font-semibold mt-4">C√°lculo de tasas de cambio</h4>

  <div class="overflow-x-auto">
  <table class="w-full text-sm border mt-2">
  <thead class="bg-gray-100 text-gray-800">
  <tr>
    <th class="border p-2">t (min)</th>
    <th class="border p-2">Adelante</th>
    <th class="border p-2">Centrada</th>
    <th class="border p-2">Atr√°s</th>
  </tr>
  </thead>
  <tbody>
  <tr><td class="border p-2">0</td><td class="border p-2">48.0</td><td class="border p-2">N/A</td><td class="border p-2">N/A</td></tr>
  <tr><td class="border p-2">10</td><td class="border p-2">54.0</td><td class="border p-2">51.0</td><td class="border p-2">48.0</td></tr>
  <tr><td class="border p-2">20</td><td class="border p-2">55.0</td><td class="border p-2">54.5</td><td class="border p-2">54.0</td></tr>
  <tr><td class="border p-2">30</td><td class="border p-2">53.0</td><td class="border p-2">54.0</td><td class="border p-2">55.0</td></tr>
  <tr><td class="border p-2">40</td><td class="border p-2">51.0</td><td class="border p-2">52.0</td><td class="border p-2">53.0</td></tr>
  <tr><td class="border p-2">50</td><td class="border p-2">49.0</td><td class="border p-2">50.0</td><td class="border p-2">51.0</td></tr>
  <tr><td class="border p-2">60</td><td class="border p-2">N/A</td><td class="border p-2">N/A</td><td class="border p-2">49.0</td></tr>
  </tbody>
  </table>
  </div>

  <hr class="my-3">

  <p class="font-medium text-sm">Interpretaci√≥n de resultados</p>
  <ul class="text-sm text-gray-700 list-disc list-inside">
    <li>La producci√≥n aumenta hasta ~30 min y luego se estabiliza ligeramente.</li>
    <li>El m√©todo centrado proporciona valores m√°s equilibrados y precisos.</li>
    <li>Forward tiende a sobreestimar y backward a subestimar.</li>
  </ul>

  <img src="image.png"class="rounded shadow-md mt-3">

  <p class="font-medium mt-3">Conclusi√≥n</p>
  <p class="text-sm text-gray-700">
  La diferenciaci√≥n num√©rica permite evaluar la eficiencia del proceso y tomar decisiones 
  industriales basadas en datos reales.
  </p>
    </div>
  </div>

  <div class="grid md:grid-cols-2 gap-6">
    <div>
      <div class="bg-white p-4 rounded shadow mb-4">
        <button onclick="startTutorial('deriv')" class="mb-2 bg-blue-500 text-white px-3 py-1 rounded flex items-center gap-1"><i class="bi bi-play-circle"></i> Tutorial</button>
        <label class="block text-sm font-medium mb-1">f(x)</label>
        <input id="exprD" class="w-full p-2 border rounded mb-3" placeholder="Ej: sin(x) + x^2" />

        <!-- Math keyboard -->
        <div class="grid grid-cols-3 sm:grid-cols-4 md:grid-cols-6 gap-2 mb-3" id="deriv-keyboard">
          <div class="keybtn" onclick="insertKey('exprD','sin(')">sin</div>
          <div class="keybtn" onclick="insertKey('exprD','cos(')">cos</div>
          <div class="keybtn" onclick="insertKey('exprD','tan(')">tan</div>
          <div class="keybtn" onclick="insertKey('exprD','ln(')">ln</div>
          <div class="keybtn" onclick="insertKey('exprD','sqrt(')">‚àö</div>
          <div class="keybtn" onclick="insertKey('exprD','^')">^</div>

          <div class="keybtn" onclick="insertKey('exprD','x')">x</div>
          <div class="keybtn" onclick="insertKey('exprD','(')">(</div>
          <div class="keybtn" onclick="insertKey('exprD',')')">)</div>
          <div class="keybtn" onclick="insertKey('exprD','pi')">œÄ</div>
          <div class="keybtn" onclick="insertKey('exprD','e')">e</div>
          <div class="keybtn" onclick="insertKey('exprD','-')">-</div>
        </div>

        <label class="block text-sm font-medium">x‚ÇÄ</label>
        <input id="x0" type="text" class="w-full p-2 border rounded mb-2" value="1" />

        <label class="block text-sm font-medium">h</label>
        <input id="h" type="text" class="w-full p-2 border rounded mb-3" value="0.1" />

        <div class="flex gap-2">
          <button id="calcDeriv" onclick="calcDeriv()" class="flex-1 bg-blue-600 text-white py-2 rounded">Calcular</button>
          <button id="explainDeriv" onclick="explainDeriv()" class="flex-1 bg-indigo-100 text-indigo-800 py-2 rounded">Paso a paso</button>
        </div>

        <button id="loadTeacherExercise" onclick="loadTeacherExercise()" class="mt-3 w-full bg-gray-200 py-2 rounded">Ejercicio de ejemplo</button>
        <div id="resD" class="mt-3 text-sm font-mono text-gray-700"></div>
      </div>
    </div>

    <div>
      <div class="bg-white p-4 rounded shadow mb-4">
        <h3 class="font-semibold mb-2">Visualizaci√≥n</h3>
        <p class="text-sm text-gray-600 mb-2">Gr√°fica de la funci√≥n y la recta tangente aproximada (derivada central).</p>
        <canvas id="chartD" style="max-height:360px"></canvas>
      </div>
      <div class="mb-4">
        <div id="tableD"></div>
      </div>
    </div>
  </div>
</section>

<section id="sec-caso-int" class="page max-w-4xl mx-auto p-4">


  <!-- ===================== CASO DE ESTUDIO INDUSTRIAL ===================== -->
<div class="bg-white p-4 rounded shadow mb-6">
  <h3 class="text-xl font-semibold mb-2">
    Estimaci√≥n del consumo energ√©tico en una l√≠nea de producci√≥n
  </h3>

  <h4 class="font-semibold mt-3">Descripci√≥n del caso de estudio:</h4>
  <p>
    En una planta industrial se desea conocer el consumo total de energ√≠a el√©ctrica de
    una l√≠nea de producci√≥n durante una jornada laboral de 6 horas, debido a que el
    consumo var√≠a con el tiempo seg√∫n la cantidad de m√°quinas activas, pausas del
    proceso y momentos de mayor actividad, se utiliza una funci√≥n que lo describe:
  </p>

  <p class="math mt-2">
    <!-- F√≥rmula original -->
    \[
    E = \int_0^6 (e^{0.1t} + t^2) \, dt
    \]
  </p>

  <p><b>Donde:</b></p>
  <ul class="list-disc ml-6">
    <li><b>tiempo (horas):</b> variable independiente.</li>
    <li><b>tasa de consumo energ√©tico (kWh/h):</b> variable dependiente.</li>
    <li><b>consumo total de energ√≠a (kWh):</b> resultado de la integral.</li>
    <li><b>n√∫mero de intervalos:</b> 1 hora cada uno.</li>
  </ul>

  <p class="mt-3">
    Para estimar el consumo total de energ√≠a durante la jornada, se aplicar√° la <b>regla del
    trapecio</b>, esta aproxima la integral de una funci√≥n evaluando puntos discretos en el
    intervalo.
  </p>

  <h4 class="font-semibold mt-3">Restricciones y condiciones:</h4>
  <ul class="list-disc ml-6">
    <li>Las mediciones son tomadas cada hora con un medidor el√©ctrico, por lo que no podemos obtener informaci√≥n m√°s precisa entre esos puntos.</li>
    <li>Se asume que el consumo var√≠a de forma continua y suave entre mediciones.</li>
    <li>No se consideran p√©rdidas externas (solo el consumo de la l√≠nea de producci√≥n).</li>
    <li>El intervalo de medici√≥n es constante.</li>
  </ul>

  <h4 class="font-semibold mt-3">Soluci√≥n por Regla del trapecio:</h4>
  <p>Consideremos la siguiente integral:</p>
  <p class="math mt-2">
    \[
    E = \int_0^6 (e^{0.1t} + t^2) \, dt
    \]
  </p>

   <p>Tenemos en cuenta que:</p>
  <p class="math mt-2">
    \[
    a = 0 \qquad b = 6
    \]
  </p>

  <p><b>Hallamos h:</b></p>
  <p class="math mt-2">
    \[
    h = \frac{b - a}{n} = \frac{6 - 0}{6} = \frac{6}{6} = 1
    \]
  </p>

    <p>Completamos la tabla como hab√≠amos explicado anteriormente:</p>

  <table class="table-auto border w-full text-center mt-3">
    <thead class="bg-gray-100">
      <tr>
        <th>\( f(t_i) \)</th>
        <th>\( f(a + ih) \)</th>
        <th>t (h)</th>
        <th>f(t)</th>
      </tr>
    </thead>
    <tbody>
      <tr><td>\( f(t_0) \)</td><td>\( f(a) \)</td><td>0</td><td>2.00000</td></tr>
      <tr><td>\( f(t_1) \)</td><td>\( f(a + h) \)</td><td>1</td><td>1.61306</td></tr>
      <tr><td>\( f(t_2) \)</td><td>\( f(a + 2h) \)</td><td>2</td><td>2.33576</td></tr>
      <tr><td>\( f(t_3) \)</td><td>\( f(a + 3h) \)</td><td>3</td><td>4.04626</td></tr>
      <tr><td>\( f(t_4) \)</td><td>\( f(a + 4h) \)</td><td>4</td><td>6.67067</td></tr>
      <tr><td>\( f(t_5) \)</td><td>\( f(a + 5h) \)</td><td>5</td><td>10.16416</td></tr>
      <tr><td>\( f(t_6) \)</td><td>\( f(b) \)</td><td>6</td><td>14.49957</td></tr>
    </tbody>
  </table>

  <p class="mt-3">
    La √∫ltima columna se halla reemplazando el valor que nos da ‚Äúx‚Äù en la tercera columna en la funci√≥n:
  </p>

  <p class="math mt-2">
    \[
    f(x) = 2e^{-0.5t} + 0.4t^2
    \]
  </p>

  <p><b>Hallar el √°rea total con la f√≥rmula:</b></p>
  <p class="math mt-2">
    \[
    \frac{h}{2} \left[ f(x_0) + 2 \sum_{i=1}^{n-1} f(x_0 + ih) + f(x_n) \right]
    \]
  </p>

  <p>
    Se resume en sumar todos los t√©rminos de la mitad para multiplicarlos por 2 y
    reemplazar \(f(x_0)\) y \(f(x_6)\) para que nos quede la siguiente f√≥rmula:
  </p>

  <p class="math mt-2">
    \[
    E = \frac{1}{2} [f(0) + 2(f(1)+f(2)+f(3)+f(4)+f(5)) + f(6)]
    \]
  </p>

  <p class="mt-3 font-semibold">El resultado final ser√≠a:</p>
  <p class="math mt-2">
    \[
    E \approx 33.079695 \, \text{kWh}
    \]
  </p>

  <h4 class="font-semibold mt-3">An√°lisis de resultados:</h4>
  <ul class="list-disc ml-6">
    <li>El consumo total estimado durante la jornada de 6 horas es aproximadamente <b>33.079695 kWh</b>.</li>
    <li>La distribuci√≥n del consumo a lo largo del tiempo muestra un incremento progresivo, comenzando con valores moderados y aumentando m√°s r√°pidamente hacia el final de la jornada.</li>
    <li>La integral aproximada refleja c√≥mo los diferentes t√©rminos de la funci√≥n contribuyen al consumo: el t√©rmino exponencial aporta m√°s al inicio, mientras que el cuadr√°tico domina en las horas finales.</li>
    <li>El uso de la regla del trapecio permiti√≥ obtener una estimaci√≥n confiable y pr√°ctica del consumo total, usando valores discretos de la funci√≥n en intervalos uniformes.</li>
    <li>Este resultado puede utilizarse para planificar la operaci√≥n de la l√≠nea de producci√≥n, anticipando la energ√≠a que se consumir√° durante la jornada y optimizando el uso de recursos el√©ctricos.</li>
  </ul>
</div>
<!-- ===================== CASO DE ESTUDIO CON M√âTODO SIMPSON 3/8 ===================== -->
<div class="bg-white p-4 rounded shadow mb-6">
  <h3 class="text-xl font-semibold mb-2">
    Aplicaci√≥n al mismo caso de estudio con m√©todo Simpson 3/8
  </h3>

  <h4 class="font-semibold mt-3">Ejercicios pr√°cticos:</h4>

  <p><b>F√≥rmula general (con h = 1):</b></p>
  <p class="math mt-2">
    \[
    I_{3/8} = \frac{3h}{8} \left( f_0 + f_n + 3 \sum_{i=1,\,i \neq 3k}^{n-1} f_i + 2 \sum_{i=3k}^{n-1} f_i \right)
    \]
  </p>

  <p>Para \(n = 6\) y \(h = 1\), se reduce a:</p>
  <p class="math mt-2">
    \[
    I_{3/8} = \frac{3}{8} \left( f_0 + f_6 + 3(f_1 + f_2 + f_4 + f_5) + 2f_3 \right)
    \]
  </p>

  <h4 class="font-semibold mt-3">Sustituyendo los valores:</h4>
  <p class="math mt-2">
    \[
    f_0 + f_6 = 2.00000 + 14.49957 = 16.49957
    \]
  </p>

  <p class="math mt-2">
    \[
    f_1 + f_2 + f_4 + f_5 = 1.61306 + 2.33576 + 6.67067 + 10.16416 = 20.78365
    \]
  </p>

  <p class="math mt-2">
    \[
    3(f_1 + f_2 + f_4 + f_5) = 3 \times 20.78365 = 62.35095
    \]
  </p>

  <p class="math mt-2">
    \[
    2f_3 = 2 \times 4.04626 = 8.09252
    \]
  </p>

  <h4 class="font-semibold mt-3">Sumando los t√©rminos interiores:</h4>
  <p class="math mt-2">
    \[
    S = 16.49957 + 62.35095 + 8.09252 = 86.94304
    \]
  </p>

  <h4 class="font-semibold mt-3">Finalmente:</h4>
  <p class="math mt-2">
    \[
    I_{3/8} = \frac{3}{8} \times 86.94304 = 32.60364 \, \text{kWh}
    \]
  </p>

  <h4 class="font-semibold mt-3">Resultados:</h4>
  <ul class="list-disc ml-6">
    <li><b>M√©todo Trapecio:</b> 33.079695 kWh</li>
    <li><b>M√©todo Simpson 3/8:</b> 32.60364 kWh</li>
  </ul>

  <h4 class="font-semibold mt-3">Comparaci√≥n m√©todos trapecio - simpson:</h4>
  <ul class="list-disc ml-6">
    <li><b>Consistencia:</b> ambos m√©todos usan los mismos puntos discretos (7 mediciones horarias), por lo que la comparaci√≥n es leg√≠tima.</li>
    <li><b>Precisi√≥n te√≥rica:</b> Simpson 3/8 tiene orden de error \(O(h^4)\), superior al del trapecio \(O(h^2)\).</li>
    <li><b>Diferencia:</b> la discrepancia (~0.476 kWh ‚âà 1.44%) es peque√±a y aceptable para prop√≥sitos de planificaci√≥n.</li>
    <li><b>Conclusi√≥n:</b> con funciones suaves, Simpson 3/8 ofrece una mejor aproximaci√≥n al comportamiento real del consumo energ√©tico.</li>
  </ul>
</div>


<!-- ===================== COMPARATIVA NUM√âRICA TRAPECIO VS SIMPSON 1/3 ===================== -->
<div class="bg-white p-4 rounded shadow mb-6">
  <h3 class="text-xl font-semibold mb-2">
    Comparaci√≥n Num√©rica: M√©todo del Trapecio vs Simpson 1/3
  </h3>

  <p>
    En este an√°lisis se realiza la comparaci√≥n entre el m√©todo del Trapecio y el m√©todo de
    <b>Simpson 1/3</b> para la evaluaci√≥n num√©rica de la siguiente integral:
  </p>

  <p class="math mt-2">
    \[
    \int_0^6 (2e^{-0.5t} + 0.4t^2) \, dt
    \]
  </p>

  <h4 class="font-semibold mt-3">Procedimiento M√©todo del Trapecio:</h4>
  <p>
    El m√©todo del Trapecio aproxima el valor de la integral mediante la suma de √°reas trapezoidales
    entre subintervalos. La f√≥rmula general es:
  </p>

  <p class="math mt-2">
    \[
    T = \frac{h}{2} [f(x_0) + 2(f(x_1) + f(x_2) + ... + f(x_{n-1})) + f(x_n)]
    \]
  </p>

  <h4 class="font-semibold mt-3">Procedimiento M√©todo de Simpson 1/3:</h4>
  <p>
    El m√©todo de Simpson 1/3 utiliza una aproximaci√≥n parab√≥lica por cada dos subintervalos. Su f√≥rmula es:
  </p>

  <p class="math mt-2">
    \[
    S = \frac{h}{3} [f(x_0) + 4(f(x_1) + f(x_3) + ... + f(x_{n-1})) + 2(f(x_2) + f(x_4) + ... + f(x_{n-2})) + f(x_n)]
    \]
  </p>

  <h4 class="font-semibold mt-3">Tabla Comparativa de Resultados:</h4>
  <table class="table-auto border w-full text-center mt-3">
    <thead class="bg-gray-100">
      <tr>
        <th>n</th>
        <th>Trapecio (Aprox.)</th>
        <th>Simpson 1/3 (Aprox.)</th>
        <th>Error Trapecio</th>
        <th>Error Simpson</th>
      </tr>
    </thead>
    <tbody>
      <tr><td>4</td><td>33.67736841</td><td>32.60711050</td><td>1.07651664</td><td>0.00625873</td></tr>
      <tr><td>6</td><td>33.07970815</td><td>32.60213319</td><td>0.47885638</td><td>0.00128142</td></tr>
      <tr><td>8</td><td>32.87028891</td><td>32.60126241</td><td>0.26943714</td><td>0.00041064</td></tr>
      <tr><td>10</td><td>32.77331545</td><td>32.60102095</td><td>0.17246368</td><td>0.00016918</td></tr>
      <tr><td>12</td><td>32.72062724</td><td>32.60093360</td><td>0.11977547</td><td>0.00008183</td></tr>
    </tbody>
  </table>

  <h4 class="font-semibold mt-3">Conclusiones:</h4>
  <ul class="list-disc ml-6">
    <li>El m√©todo del trapecio presenta errores m√°s altos y converge lentamente al aumentar n.</li>
    <li>El m√©todo de Simpson 1/3 alcanza alta precisi√≥n incluso con pocos subintervalos.</li>
    <li>Por tanto, <b>Simpson 1/3 es m√°s eficiente y preciso</b> para aproximar la integral dada.</li>
  </ul>
</div>


  <div class="grid md:grid-cols-2 gap-6">
    <div>
      <div class="bg-white p-4 rounded shadow mb-4">
        <button onclick="startTutorial('int')" class="mb-2 bg-blue-500 text-white px-3 py-1 rounded flex items-center gap-1"><i class="bi bi-play-circle"></i> Tutorial</button>
        <label class="block text-sm font-medium mb-1">f(x)</label>
        <input id="exprI" class="w-full p-2 border rounded mb-3" placeholder="Ej: x^2 + 1" />

        <!-- Math keyboard -->
        <div class="grid grid-cols-3 sm:grid-cols-4 md:grid-cols-6 gap-2 mb-3" id="int-keyboard">
          <div class="keybtn" onclick="insertKey('exprI','sin(')">sin</div>
          <div class="keybtn" onclick="insertKey('exprI','cos(')">cos</div>
          <div class="keybtn" onclick="insertKey('exprI','tan(')">tan</div>
          <div class="keybtn" onclick="insertKey('exprI','ln(')">ln</div>
          <div class="keybtn" onclick="insertKey('exprI','sqrt(')">‚àö</div>
          <div class="keybtn" onclick="insertKey('exprI','^')">^</div>
          <div class="keybtn" onclick="insertKey('exprI','x')">x</div>
          <div class="keybtn" onclick="insertKey('exprI','(')">(</div>
          <div class="keybtn" onclick="insertKey('exprI',')')">)</div>
          <div class="keybtn" onclick="insertKey('exprI','pi')">œÄ</div>
          <div class="keybtn" onclick="insertKey('exprI','e')">e</div>
          <div class="keybtn" onclick="insertKey('exprI','-')">-</div>
        </div>

        <div class="flex gap-2 mb-3">
          <div><label class="block text-sm font-medium">a</label><input id="a" type="text" class="w-full p-2 border rounded" value="0" /></div>
          <div><label class="block text-sm font-medium">b</label><input id="b" type="text" class="w-full p-2 border rounded" value="1" /></div>
        </div>
        <label class="block text-sm font-medium">n (subintervalos)</label>
        <input id="n" type="text" class="w-full p-2 border rounded mb-3" value="10" />

        <div class="flex gap-2">
          <button id="calcInt" onclick="calcInt()" class="flex-1 bg-blue-600 text-white py-2 rounded">Calcular</button>
          <button id="explainInt" onclick="explainInt()" class="flex-1 bg-indigo-100 text-indigo-800 py-2 rounded">Paso a paso</button>
        </div>
        <div id="resI" class="mt-3 text-sm font-mono text-gray-700"></div>
      </div>
    </div>
    <div>
      <div class="bg-white p-4 rounded shadow mb-4"><h3 class="font-semibold mb-2">Visualizaci√≥n</h3><p class="text-sm text-gray-600 mb-2">Gr√°fica de la funci√≥n integrada.</p><canvas id="chartI" style="max-height:360px"></canvas></div>
      <div id="areaTable" class="bg-white p-4 rounded shadow mb-4"></div>
    </div>
  </div>
</section>

<section id="sec-inicio" class="page active max-w-4xl mx-auto p-4">
  <div class="bg-white p-6 rounded shadow">
    <h2 class="text-2xl font-semibold mb-4">Bienvenido a la Aplicaci√≥n de M√©todos Num√©ricos</h2>
    <p class="text-gray-700 leading-relaxed">
      Esta es una herramienta interactiva dise√±ada para ayudarte a aprender y practicar conceptos fundamentales de m√©todos num√©ricos, como la diferenciaci√≥n y la integraci√≥n.
      <br><br>
      Navega a trav√©s de las secciones usando el men√∫ superior para explorar la teor√≠a, ver casos de estudio aplicados y utilizar las calculadoras interactivas.
      <br><br>
      <b>¬°Comienza a explorar y a aprender!</b>
    </p>
  </div>
</section>

<section id="sec-recursos" class="page max-w-4xl mx-auto p-4">
  <h2 class="text-2xl font-semibold mb-4">Recursos Adicionales</h2>

  <div class="bg-white p-4 rounded shadow mb-6">
    <h3 class="font-semibold mb-3">Algoritmos en L√≠nea</h3>
    <div class="grid md:grid-cols-2 gap-4">
      <button onclick="window.open('https://onlinegdb.com/SsSY13vTC', '_blank')" class="w-full bg-blue-600 text-white py-3 px-6 rounded text-lg font-semibold">Algoritmo de Diferenciaci√≥n</button>
      <button onclick="window.open('https://onlinegdb.com/iqQ__bnp1J', '_blank')" class="w-full bg-blue-600 text-white py-3 px-6 rounded text-lg font-semibold">Algoritmo de Integraci√≥n</button>
    </div>
  </div>

  <div class="bg-white p-4 rounded shadow mb-6">
    <h3 class="font-semibold mb-3">Videos Explicativos</h3>
    <p class="text-sm text-gray-600 mb-4">Aqu√≠ puedes visualizar videos de YouTube. </p>
    
    <!-- Ejemplo de Video de YouTube -->
    <div class="aspect-w-16 aspect-h-9">
      <iframe src="https://www.youtube.com/embed/ID_DEL_VIDEO" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" allowfullscreen class="w-full h-full rounded"></iframe>
      <div class="bg-gray-200 w-full h-full rounded flex items-center justify-center">
      </div>
    </div>

  </div>
</section>

  <!-- TUTORIAL INTRO (modal) -->
  <div id="tutorialIntro" class="hidden fixed inset-0 flex items-center justify-center z-50">
    <div class="bg-white p-6 rounded max-w-lg">
      <h3 class="text-xl font-bold mb-2">Tutorial r√°pido</h3>
      <p class="text-sm mb-3">
        1) Escribe una funci√≥n con el teclado o manualmente (ej: <code>sin(x)+x^2</code>)<br>
        2) Usa el teclado para s√≠mbolos ‚àö, œÄ, e, ^, par√©ntesis, etc.<br>
        3) En 'h' puedes poner coma o punto (ej: 0,1 √≥ 0.1) ‚Äî se corrige autom√°ticamente.<br>
        4) Pulsa <b>Calcular</b> y luego <b>Paso a paso</b> para ver la explicaci√≥n.
      </p>
      <div class="flex gap-2">
        <button onclick="closeTutorialIntro()" class="flex-1 bg-blue-600 text-white py-2 rounded">Comenzar</button>
        <button onclick="openTutorial('Gu√≠a r√°pida', ['¬øQu√© es derivada?', '¬øQu√© es integraci√≥n?'])" class="flex-1 bg-gray-200 py-2 rounded">Ver gu√≠a</button>
      </div>
    </div>
  </div>

  <!-- STEP-BY-STEP MODAL -->
  <div id="tutorialModal" class="hidden fixed inset-0 flex items-center justify-center z-50">
    <div class="bg-white p-6 rounded relative">
      <button id="btnClose" class="absolute top-2 right-2 bg-red-500 text-white px-2 py-1 rounded text-sm">√ó</button>
      <h3 id="tutorialTitle" class="text-xl font-bold mb-3"></h3>
      <div id="tutorialContent" class="text-sm mb-4"></div>
    </div>
  </div>

  <!-- Floating Help Button -->
  <button id="helpButton" class="group fixed bottom-6 right-6 z-40 flex items-center justify-center w-16 h-16 bg-blue-500 rounded-full shadow-lg focus:outline-none animate-pulse-border">
    <img src="saludando.png" alt="Ayuda" class="w-14 h-14 object-contain">
    <div id="helpTooltip" class="absolute bottom-full right-0 mb-2 hidden group-hover:block w-auto p-2 min-w-max rounded-md shadow-md text-white bg-gray-700 text-xs font-bold">
      ¬øNecesitas ayuda?
    </div>
  </button>

  <script>
  /* -----------------------
    UTIL: Help Tooltip Animation
    ----------------------- */
  document.addEventListener('DOMContentLoaded', () => {
    const helpTooltip = document.getElementById('helpTooltip');
    if (helpTooltip) {
      setInterval(() => {
        // No mostrar si un tutorial est√° activo
        if (document.querySelector('#tutorial-overlay, div[style*="z-index:9998"]')) return;

        helpTooltip.classList.remove('hidden');
        setTimeout(() => {
          helpTooltip.classList.add('hidden');
        }, 3000); // Visible por 3 segundos
      }, 10000); // Cada 10 segundos
    }

    const pages = document.querySelectorAll('.page');
    const navBtns = document.querySelectorAll('.nav-btn');

    navBtns.forEach(b => {
      b.addEventListener('click', () => {
        const id = b.dataset.page;
        const targetPage = document.getElementById(id);

        pages.forEach(p => p.classList.remove('active'));

        // Mostrar las secciones correspondientes
        if (targetPage) { targetPage.classList.add('active'); }
        
        // Cierra el men√∫ m√≥vil si est√° abierto
        document.getElementById('menuMobile').classList.add('hidden');

        // Si se carga la p√°gina de integraci√≥n, cargar datos de ejemplo
        if (id === 'sec-caso-int') {
          loadIntegrationCaseStudy();
        }

        // Vuelve arriba de la p√°gina
        window.scrollTo({ top: 0, behavior: 'smooth' });
      });
    });

  // --- Bot√≥n de ayuda principal ---
  const helpButton = document.getElementById('helpButton');
  if (helpButton) helpButton.addEventListener('click', startPageTour);

  // Men√∫ m√≥vil toggle
  document.getElementById('menuBtn').onclick = () => document.getElementById('menuMobile').classList.toggle('hidden');

  });

    // --- Asistente de Recorrido Mejorado ---
    const pageTours = {
    'sec-inicio': [
      { element: 'header nav, #menuBtn', text: 'üëã ¬°Hola! Soy <b>Nick</b>. Te mostrar√© c√≥mo funciona el men√∫ principal.' },
      { element: 'button[data-page="sec-teoria"]', text: 'En <b>Teor√≠a</b> aprender√°s los conceptos clave de los m√©todos num√©ricos.' },
      { element: 'button[data-page="sec-caso-deriv"]', text: 'En <b>Caso Derivadas</b> podr√°s practicar la diferenciaci√≥n con un ejemplo real.' },
      { element: 'button[data-page="sec-caso-int"]', text: 'En <b>Caso Integraci√≥n</b> ver√°s c√≥mo se aplica la integraci√≥n en un escenario industrial.' },
      { element: 'button[data-page="sec-recursos"]', text: 'Finalmente, en <b>Recursos</b> encontrar√°s enlaces y algoritmos √∫tiles para profundizar.' },
      { element: '#sec-inicio .bg-white', text: 'üìò Aqu√≠ comienza tu recorrido. En esta secci√≥n conocer√°s los fundamentos de nuestra herramienta interactiva.' }
    ],
    'sec-teoria': [
      { element: '#sec-teoria > h2:nth-of-type(1)', text: 'üìñ En esta parte conocer√°s la <b>Diferenciaci√≥n Num√©rica</b>: sus fundamentos y f√≥rmulas principales.' },
      { element: '#sec-teoria > h2:nth-of-type(2)', text: 'üßÆ M√°s abajo ver√°s todo sobre la <b>Integraci√≥n Num√©rica</b>, incluyendo la Regla del Trapecio.' }
    ],
    'sec-caso-deriv': [
      { element: '#sec-caso-deriv .bg-white:first-child', text: 'üîç Este es el <b>Caso de Estudio de Derivadas</b>. Aqu√≠ se aplica la diferenciaci√≥n en un escenario real.' },
      { element: '#sec-caso-deriv .grid > div:first-child .bg-white', text: '‚öôÔ∏è Usa esta calculadora para probar tus propias funciones y observar los resultados.' },
      { element: '#sec-caso-deriv button[onclick*="startTutorial"]', text: 'üéì Si quieres una gu√≠a detallada, haz clic en el bot√≥n ‚ÄúTutorial‚Äù.' }
    ],
    'sec-caso-int': [
      { element: '#sec-caso-int .bg-white:first-child', text: 'üîã Bienvenido al <b>Caso de Estudio de Integraci√≥n</b>. Aqu√≠ se calcula el consumo energ√©tico de una planta industrial.' },
      { element: '#sec-caso-int .grid > div:first-child .bg-white', text: 'üß† Practica la integraci√≥n num√©rica con tu propia funci√≥n en esta calculadora interactiva.' },
      { element: '#sec-caso-int button[onclick*="startTutorial"]', text: 'üìò ¬øQuieres aprender paso a paso? Haz clic en el bot√≥n ‚ÄúTutorial‚Äù.' }
    ],
    'sec-recursos': [
      { element: '#sec-recursos .bg-white:nth-of-type(1)', text: 'üß∞ En esta secci√≥n encontrar√°s enlaces a los <b>recursos y algoritmos</b> para experimentar con el c√≥digo fuente.' },
      { element: '#sec-recursos .bg-white:nth-of-type(2)', text: 'üé• Aqu√≠ podr√°s visualizar videos explicativos o material audiovisual complementario.' }
    ]
  };

  function startPageTour() {
    const activePage = document.querySelector('.page.active');
    if (!activePage) return;

    const tourSteps = pageTours[activePage.id];
    if (!tourSteps) return;

    let step = 0;

    // --- Overlay oscuro ---
    const overlay = document.createElement('div');
    overlay.style.cssText = `
      position:fixed;top:0;left:0;width:100%;height:100%;
      background:rgba(0,0,0,0.5);
      z-index:9998;transition:opacity .3s;
    `;
    document.body.appendChild(overlay);

    // --- Caja de texto ---
    const box = document.createElement('div');
    box.style.cssText = `
      position:absolute;background:#1e293b;color:white;
      padding:18px 20px;border-radius:10px;max-width:320px;
      box-shadow:0 4px 14px rgba(0,0,0,0.6);
      font-size:15px;line-height:1.5;z-index:9999;transition:all .3s;
    `;
    
    const avatar = document.createElement('img');
    avatar.src = 'saludando.png';
    avatar.alt = 'Nick';
    avatar.style.cssText = `
      position:absolute; width:60px; height:60px;
      left:10px; top:10px;
    `;

    const text = document.createElement('p');
    text.style.marginLeft = '65px'; // Espacio para el avatar

    const controls = document.createElement('div');
    controls.style.textAlign = 'right';
    controls.style.marginTop = '12px';
    controls.style.marginLeft = '65px'; // Alinear con el texto

    const nextBtn = document.createElement('button');
    nextBtn.textContent = 'Siguiente';
    nextBtn.style.cssText = `
      padding:6px 14px;border:none;border-radius:6px;
      background:#3b82f6;color:white;cursor:pointer;
      font-weight:600;transition:background .2s;
    `;
    nextBtn.onmouseover = () => nextBtn.style.background = '#2563eb';
    nextBtn.onmouseleave = () => nextBtn.style.background = '#3b82f6';

    controls.appendChild(nextBtn);
    box.appendChild(avatar);
    box.appendChild(text);
    box.appendChild(controls);
    document.body.appendChild(box);

    // --- Funci√≥n para mostrar cada paso ---
    function showTourStep() {
      const current = tourSteps[step];
      let el = Array.from(document.querySelectorAll(current.element)).find(e => e.offsetParent !== null);

      if (!el) {
        // Si no se encuentra el elemento visible, puede ser porque el men√∫ m√≥vil est√° cerrado.
        // Intentamos abrirlo y buscar de nuevo.
        const menuBtn = document.getElementById('menuBtn');
        const menuMobile = document.getElementById('menuMobile');
        if (menuBtn && menuBtn.offsetParent !== null && menuMobile && menuMobile.classList.contains('hidden')) {
          menuMobile.classList.remove('hidden');
          el = Array.from(document.querySelectorAll(current.element)).find(e => e.offsetParent !== null);
        }
      }

      // Scroll al elemento
      el.scrollIntoView({ behavior: 'smooth', block: 'center' });

      // Resaltar elemento
      document.querySelectorAll('.tour-highlight').forEach(e => e.classList.remove('tour-highlight'));
      el.classList.add('tour-highlight');
      
      setTimeout(() => {
        const rect = el.getBoundingClientRect();
        text.innerHTML = current.text;

        // --- L√≥gica de posicionamiento mejorada ---
        box.style.top = `${rect.bottom + 12 + window.scrollY}px`;
        let newLeft = rect.left + window.scrollX;
        const boxWidth = box.offsetWidth;
        const windowWidth = window.innerWidth;

        // Ajusta si se sale por la derecha
        if (newLeft + boxWidth > windowWidth - 10) {
          newLeft = windowWidth - boxWidth - 10;
        }
        // Ajusta si se sale por la izquierda
        if (newLeft < 10) newLeft = 10;

        box.style.left = `${newLeft}px`;
        nextBtn.textContent = (step === tourSteps.length - 1) ? 'Finalizar' : 'Siguiente';
      }, 300); // Esperar a que el scroll termine
    }

    // --- Bot√≥n siguiente ---
    nextBtn.onclick = () => {
      if (step < tourSteps.length - 1) {
        step++;
        showTourStep();
      } else {
        overlay.remove();
        box.remove();
        document.querySelectorAll('.tour-highlight').forEach(e => e.classList.remove('tour-highlight'));
      }
    };

    showTourStep(); 
    
  }

  // --- Estilos del resaltado ---
  const style = document.createElement('style');
  style.textContent = `
    .tour-highlight {
      outline: 3px solid #3b82f6;
      outline-offset: 3px;
      border-radius: 6px;
      transition: outline .2s;
    }
  `;
  document.head.appendChild(style);

  /* -----------------------
    UTIL: Insert keyboard keys
    ----------------------- */
  function insertKey(id, val){
    const el = document.getElementById(id);
    const pos = el.selectionStart || el.value.length;
    el.value = el.value.slice(0,pos) + val + el.value.slice(pos);
    el.focus();
    el.selectionStart = el.selectionEnd = pos + val.length;
  }

  /* -----------------------
    PARSER: support natural math + fractions
    - converts: sin -> Math.sin, ^ -> **, pi -> Math.PI
    - converts fractions like 1/2x -> (1/2)*x and 3/4 -> (3/4)
    - replace commas with dots in numbers
    ----------------------- */
  function parseExpr(raw){
    if(!raw) return raw;
    let s = String(raw);

    // replace comma decimals "0,1" -> "0.1" (careful: replace only inside numbers)
    s = s.replace(/(\d+),(\d+)/g, (m,a,b)=> a + '.' + b);

    // Insert multiplication for cases like ')x' or '2x' or ')( ' 
    // But first handle fraction patterns: digits/digits optionally followed by variable
    s = s.replace(/(\d+)\s*\/\s*(\d+)/g, '($1/$2)'); // 1/2 -> (1/2)

    // If pattern like (1/2)x or (1/2) x => ensure (1/2)*x
    s = s.replace(/\)\s*(?=[a-zA-Z\(])/g, ')*');

    // Cases like (1/2)x without space were converted to (1/2)x -> add *
    s = s.replace(/\)\s*([a-zA-Z\(])/g, ')*$1');

    // Cases like 2x => 2*x (add multiplication between number and variable/parenthesis)
    s = s.replace(/(\d)(?=\s*[a-zA-Z\(])/g, '$1*');

    // Replace caret with exponent
    s = s.replace(/\^/g, '**');

    // Replace common functions and constants (case-insensitive)
    s = s.replace(/\bpi\b/gi, 'Math.PI');
    s = s.replace(/\be\^/gi, 'Math.exp('); // e^(
    // If user wrote e^x (without parenthesis), convert e^x -> Math.exp(x)
    s = s.replace(/\bMath\.exp\(\s*([^\)]+)\s*\)/g, 'Math.exp($1)'); // already ok
    // convert functions
    s = s.replace(/\bsin\b/gi, 'Math.sin'); // Fix: Added missing closing brace for Math.exp
    s = s.replace(/\bcos\b/gi, 'Math.cos');
    s = s.replace(/\btan\b/gi, 'Math.tan');
    s = s.replace(/\bsqrt\b/gi, 'Math.sqrt');
    s = s.replace(/\bln\b/gi, 'Math.log');
    s = s.replace(/\blog\b/gi, 'Math.log');

    // Close unmatched Math.exp( if user wrote e^(...) we try to keep as Math.exp(...)
    // (user should write e^(x) or exp(x) ideally)
    // Ensure single '*' doesn't remain false
    return s;
  }

  function makeFunction(expr){
    const parsed = parseExpr(expr || '');
    try{
      // use with(Math) to have math functions available without Math prefix in some cases
      return new Function('x', `with(Math){ return ${parsed}; }`);
    } catch(e){
      // throw error upwards
      throw new Error('Expresi√≥n inv√°lida: ' + e.message);
    }
  }

  /* -----------------------
    UTIL: normalize numeric inputs (commas -> dots)
    ----------------------- */
  function normNumInput(id){
    const el = document.getElementById(id);
    if(!el) return null;
    const v = String(el.value).trim();
    if(v === '') return NaN;
    // replace comma decimals
    const v2 = v.replace(/,/g, '.');
    return Number(v2);
  }

  /* -----------------------
    DERIVADAS
    ----------------------- */
  let chartDInstance = null;
  function calcDeriv(){
    try{
      const expr = document.getElementById('exprD').value;
      if(!expr){ resD.innerHTML = 'Introduce una funci√≥n.'; return; }

      const x0raw = document.getElementById('x0').value;
      const hraw = document.getElementById('h').value;
      // normalize comma -> dot and support pi, e, œÄ
      let x0str = String(x0raw).trim().replace(/,/g,'.').replace(/\bpi\b/gi, Math.PI.toString()).replace(/œÄ/g, Math.PI.toString()).replace(/\be\b/gi, Math.E.toString());
      let hstr = String(hraw).trim().replace(/,/g,'.').replace(/\bpi\b/gi, Math.PI.toString()).replace(/œÄ/g, Math.PI.toString()).replace(/\be\b/gi, Math.E.toString());
      const x0 = Number(x0str);
      const h = Number(hstr);

      if(!isFinite(x0) || !isFinite(h) || h <= 0){ resD.innerHTML = 'x‚ÇÄ y h deben ser n√∫meros v√°lidos (h>0).'; return; }

      const fn = makeFunction(expr);

      const f_x0 = fn(x0); // check nan?
      if(!isFinite(f_x0)) { resD.innerHTML = 'La funci√≥n no es v√°lida en x‚ÇÄ.'; return; }

      const forward = (fn(x0 + h) - fn(x0)) / h;
      const backward = (fn(x0) - fn(x0 - h)) / h;
      const central = (fn(x0 + h) - fn(x0 - h)) / (2 * h);

      resD.innerHTML = `Forward: ${forward.toFixed(8)}<br>Backward: ${backward.toFixed(8)}<br>Central: ${central.toFixed(8)}`;

      // build plot
      const xs = Array.from({length:300}, (_,i) => x0 - 6 + i * 0.04);
      const ys = xs.map(xx => {
        const v = fn(xx);
        return (Number.isFinite(v) ? v : NaN);
      });
      const slope = central;
      const tangent = xs.map(xx => fn(x0) + slope * (xx - x0));

      if(chartDInstance) chartDInstance.destroy();
      chartDInstance = new Chart(document.getElementById('chartD').getContext('2d'), {
        type: 'line',
        data: {
          labels: xs,
          datasets: [
            { label: 'f(x)', data: ys, borderWidth: 2, pointRadius: 0, tension: 0.2 },
            { label: 'Tangente (aprox)', data: tangent, borderDash: [6,4], borderWidth: 2, pointRadius: 0 }
          ]
        },
        options: { responsive: true, scales: { x: { title: { display: true, text: 'x' } }, y: { title: { display: true, text: 'f(x)' } } } }
      });

    } catch(err){
      resD.innerHTML = 'Error: ' + (err.message || err);
    }
  }

  /* -----------------------
    EXPLAIN DERIV STEP-BY-STEP with MathJax
    ----------------------- */
  function explainDeriv() {
    try {
      const expr = document.getElementById('exprD').value.trim();
      if (!expr) { alert('Ingresa una funci√≥n'); return; }

      const x0 = Number(String(document.getElementById('x0').value).replace(/,/g,'.'));
      const h  = Number(String(document.getElementById('h').value).replace(/,/g,'.'));

      if (!isFinite(x0) || !isFinite(h) || h <= 0){
        alert('Valores inv√°lidos. Aseg√∫rate de que x‚ÇÄ sea num√©rico y h > 0');
        return;
      }

      let fn;
      try{
        fn = makeFunction(expr);
      }catch(e){
        alert("Error interpretando la funci√≥n. Revisa la sintaxis.");
        return;
      }

      const f0  = fn(x0);
      const fph = fn(x0 + h);
      const fmh = fn(x0 - h);

      const forward  = (fph - f0) / h;
      const backward = (f0 - fmh) / h;
      const central  = (fph - fmh) / (2*h);

      const steps = [
        `<b>Algoritmo paso a paso</b><br><br>`,
        `<b>Funci√≥n:</b> \\( f(x) = ${expr} \\)`,
        `<b>Datos iniciales:</b> \\( x_0 = ${x0},\\; h = ${h} \\)<br><br>`,

        `<b>Paso 1.</b> Sustituimos en la funci√≥n:`,
        `\\[ f(${x0}) = ${expr.replace(/x/g,`(${x0})`)} \\]`,
        `\\[ f(${x0}+${h}) = ${expr.replace(/x/g,`(${x0}+${h})`)} \\]`,
        `\\[ f(${x0}-${h}) = ${expr.replace(/x/g,`(${x0}-${h})`)} \\]<br>`,

        `<b>Evaluamos:</b>`,
        `\\[ f(${x0}) = ${f0.toFixed(8)} \\]`,
        `\\[ f(${x0}+${h}) = ${fph.toFixed(8)} \\]`,
        `\\[ f(${x0}-${h}) = ${fmh.toFixed(8)} \\]<br><br>`,

        `<b>Paso 2.</b> Diferencia hacia adelante:`,
        `\\[ f'(x_0) \\approx \\frac{${fph.toFixed(8)} - ${f0.toFixed(8)}}{${h}} = ${forward.toFixed(8)} \\]<br><br>`,

        `<b>Paso 3.</b> Diferencia hacia atr√°s:`,
        `\\[ f'(x_0) \\approx \\frac{${f0.toFixed(8)} - ${fmh.toFixed(8)}}{${h}} = ${backward.toFixed(8)} \\]<br><br>`,

        `<b>Paso 4.</b> Diferencia centrada:</b>`,
        `\\[ f'(x_0) \\approx \\frac{${fph.toFixed(8)} - ${fmh.toFixed(8)}}{2\\cdot${h}} = ${central.toFixed(8)} \\]<br><br>`,

        `<b>Resultado final:</b> \\( f'(x_0) \\approx ${central.toFixed(8)} \\)`
      ];

      openTutorial('', steps);

      if (window.MathJax) {
        MathJax.typesetPromise?.() || MathJax.typeset();
      }

    } catch(e){
      alert('Error en explicaci√≥n: ' + e.message);
    }
  }



  /* -----------------------
    LOAD TEACHER EXERCISE
    f(x) = ((3x-1)/(x^2+3))^2
    exact derivative provided:
    f'(x) = (-18 + 50x + 18x^2 - 18x^3) / (x^2 + 3)^3
    ----------------------- */
  function loadTeacherExercise(){
    const expr = '((3*x - 1)/(x^2 + 3))^2';
    document.getElementById('exprD').value = expr;
    document.getElementById('x0').value = '1';
    document.getElementById('h').value = '0.1';
    // compute
    calcDeriv();
    // compute exact derivative and show error table
    try{
      const fn = makeFunction(expr);
      const dexpr = '(-18 + 50*x + 18*x^2 - 18*x^3) / (x^2 + 3)**3';
      const dfn = makeFunction(dexpr);
      const x0 = 1;
      const h = 0.1;
      const forward = (fn(x0 + h) - fn(x0)) / h;
      const backward = (fn(x0) - fn(x0 - h)) / h;
      const central = (fn(x0 + h) - fn(x0 - h)) / (2 * h);
      const exact = dfn(x0);
      const errF = Math.abs(forward - exact);
      const errB = Math.abs(backward - exact);
      const errC = Math.abs(central - exact);

      const tableHtml = `
        <table class="w-full text-sm">
          <thead><tr><th class="text-left">M√©todo</th><th>Valor</th><th>Error abs.</th></tr></thead>
          <tbody>
            <tr><td>Forward</td><td>${forward.toFixed(8)}</td><td>${errF.toExponential(3)}</td></tr>
            <tr><td>Backward</td><td>${backward.toFixed(8)}</td><td>${errB.toExponential(3)}</td></tr>
            <tr><td>Central</td><td>${central.toFixed(8)}</td><td>${errC.toExponential(3)}</td></tr>
            <tr class="bg-gray-50"><td>Derivada exacta</td><td colspan="2">${exact.toFixed(8)}</td></tr>
          </tbody>
        </table>
      `;
      document.getElementById('tableD').innerHTML = tableHtml;
      // Also open step-by-step automatically
      explainDeriv();
    } catch(e){
      document.getElementById('tableD').innerText = 'Error al evaluar ejercicio: ' + e.message;
    }
  }

  /* -----------------------
    INTEGRACI√ìN
    ----------------------- */
  let chartIInstance = null;
  function calcInt(){
    try{
      const expr = document.getElementById('exprI').value;
      if(!expr){ resI.innerHTML = 'Introduce una funci√≥n.'; return; }
      const a = Number(String(document.getElementById('a').value).replace(/,/g,'.'));
      const b = Number(String(document.getElementById('b').value).replace(/,/g,'.'));
      let n = parseInt(document.getElementById('n').value);
      if(!(isFinite(a) && isFinite(b) && n > 0 && a < b)){ resI.innerHTML = 'Entradas inv√°lidas (a < b, n entero >0).'; return; }
      const fn = makeFunction(expr);

      const h = (b - a) / n;
      // trapecio
      let trap = 0.5 * (fn(a) + fn(b));
      for(let i=1;i<n;i++) trap += fn(a + i*h);
      trap *= h;
      // simpson (use n2 even)
      let n2 = n; if(n2 % 2 === 1) n2++;
      const h2 = (b - a) / n2;
      let simp = fn(a) + fn(b);
      for(let i=1;i<n2;i++) simp += (i % 2 === 0 ? 2*fn(a + i*h2) : 4*fn(a + i*h2));
      simp *= h2/3;

      resI.innerHTML = `Trapecio: ${trap.toFixed(8)}<br>Simpson: ${simp.toFixed(8)}`;

      const xs = Array.from({length:320}, (_,i) => a + i*(b-a)/319);
      const ys = xs.map(xx => { const v = fn(xx); return Number.isFinite(v) ? v : NaN; });

      if(chartIInstance) chartIInstance.destroy();
      chartIInstance = new Chart(document.getElementById('chartI').getContext('2d'), {
        type: 'line',
        data: { labels: xs, datasets: [{ label: 'f(x)', data: ys, borderWidth:2, pointRadius:0 }] },
        options: { responsive:true }
      });

      // build a small table for trapecios (optional)
      const rows = [];
      for(let i=0;i<=n;i++){
        const xi = a + i*h;
        rows.push(`<tr><td class="border border-gray-300 p-2 text-center">${i}</td><td class="border border-gray-300 p-2 text-center">${xi.toFixed(6)}</td><td class="border border-gray-300 p-2 text-center">${fn(xi).toFixed(6)}</td></tr>`);
      }
      document.getElementById('areaTable').innerHTML = `<div class="overflow-x-auto"><table class="w-full text-sm border-collapse border border-gray-300"><thead><tr class="bg-gray-100"><th class="border border-gray-300 p-2 font-semibold">#</th><th class="border border-gray-300 p-2 font-semibold">x</th><th class="border border-gray-300 p-2 font-semibold">f(x)</th></tr></thead><tbody>${rows.join('')}</tbody></table></div>`;

    } catch(err){
      resI.innerHTML = 'Error: ' + (err.message || err);
    }
  }

  /* -----------------------
    STEP-BY-STEP modal logic (LaTeX)
    ----------------------- */
  function openTutorial(title, steps){
    document.getElementById('tutorialTitle').innerText = title || '';
    const processedSteps = steps.map(step => step.replace(/\*\*(.*?)\*\*/g, '<strong>$1</strong>').replace(/\*(.*?)\* /g, '<em>$1</em>'));
    const content = processedSteps.map(step => `<p style="margin-bottom: 1rem;">${step}</p>`).join('');
    document.getElementById('tutorialContent').innerHTML = content;
    document.getElementById('tutorialModal').classList.remove('hidden');
    setTimeout(() => {
      if (window.MathJax) {
        MathJax.typesetPromise([document.getElementById('tutorialContent')]);
      }
    }, 100);
  }
  document.getElementById('btnClose').onclick = ()=> document.getElementById('tutorialModal').classList.add('hidden');

  function openTutorialIntro(){ document.getElementById('tutorialIntro').classList.remove('hidden'); }
  function closeTutorialIntro(){ document.getElementById('tutorialIntro').classList.add('hidden'); localStorage.setItem('tutorialShown','1'); }
  // Tutorial intro removed - no longer appears on first load

  /* -----------------------
    EXPLAIN INT STEP-BY-STEP with MathJax
    ----------------------- */
  function explainInt() {
    try {
      const expr = document.getElementById('exprI').value.trim();
      if (!expr) { alert('Ingresa una funci√≥n'); return; }

      const a = Number(String(document.getElementById('a').value).replace(/,/g,'.'));
      const b = Number(String(document.getElementById('b').value).replace(/,/g,'.'));
      const nInput = document.getElementById('n').value;
      const n = parseInt(nInput);

      if (!isFinite(a) || !isFinite(b) || !isFinite(n) || n <= 0 || a >= b) {
        alert('Valores inv√°lidos. Aseg√∫rate: a<b y n>0');
        return;
      }

      let fn;
      try {
        fn = makeFunction(expr);
      } catch {
        alert("Error interpretando la funci√≥n. Revisa la sintaxis.");
        return;
      }

      // Paso del m√©todo
      const h = (b - a) / n;

      // Puntos
      const points = [];
      for (let i = 0; i <= n; i++) {
        const xi = a + i * h;
        points.push({ i, xi, fxi: fn(xi) });
      }

      // Trapecio
      let trapSum = 0.5 * (points[0].fxi + points[n].fxi);
      for (let i = 1; i < n; i++) trapSum += points[i].fxi;
      const trapResult = trapSum * h;

      // Simpson ‚Äî n debe ser par
      let nS = n;
      if (nS % 2 === 1) nS++; // Ajuste si n es impar
      const hS = (b - a) / nS;

      let simpsonSum = fn(a) + fn(b);
      for (let i = 1; i < nS; i++) {
        const coeff = (i % 2 === 0) ? 2 : 4;
        simpsonSum += coeff * fn(a + i * hS);
      }
      const simpsonResult = simpsonSum * hS / 3;

      // Construcci√≥n de pasos
      const steps = [
        `<b>Algoritmo paso a paso</b><br><br>`,

        `<b>Funci√≥n:</b> \\( f(x) = ${expr} \\)`,
        `<b>Datos iniciales:</b> \\( a=${a},\\; b=${b},\\; n=${n} \\)<br><br>`,

        `<b>Paso 1.</b> Sustituimos en la funci√≥n:`,
        `\\[ f(x) = ${expr} \\]`,
        `\\[ f(a) = f(${a}) = ${expr.replace(/x/g, "(" + a + ")")} \\]`,
        `\\[ f(b) = f(${b}) = ${expr.replace(/x/g, "(" + b + ")")} \\]<br>`,

        `<b>Paso 2.</b> Calculamos el tama√±o del subintervalo:`,
        `\\[ h = \\frac{b-a}{n} = \\frac{${b}-${a}}{${n}} = ${h.toFixed(6)} \\]<br>`,

        `<b>Paso 3.</b> Construimos la tabla de valores:</b><br>`,

        `\\[
          \\begin{array}{c|c|c}
          i & x_i & f(x_i) \\\\ \\hline
          ${points.map(p => `${p.i} & ${p.xi.toFixed(6)} & ${p.fxi.toFixed(8)}`).join(' \\\\ ')}
          \\end{array}
        \\]<br><br>`,

        `<b>Paso 4.</b> Regla del trapecio:</b>`,
        `\\[
          \\int_a^b f(x) dx \\approx
          h \\left[
            \\frac{f(a)+f(b)}{2}
            + \\sum_{i=1}^{n-1} f(x_i)
          \\right]
        \\]`,
        `\\[
          = ${h.toFixed(6)} \\left[
          \\frac{${points[0].fxi.toFixed(8)} + ${points[n].fxi.toFixed(8)}}{2}
          + (${points.slice(1,n).map(p=>p.fxi.toFixed(8)).join(" + ")})
          \\right]
          = ${trapResult.toFixed(8)}
        \\]<br><br>`,

        `<b>Paso 5.</b> Regla de Simpson (1/3):</b>`,
        `\\[
          \\int_a^b f(x) dx \\approx
          \\frac{h}{3}\\left[
            f(a)+f(b)
            +4\\sum_{i \\text{ impar}} f(x_i)
            +2\\sum_{i \\text{ par}} f(x_i)
          \\right]
        \\]`,
        `<i>Nota:</i> Se ajusta n a ${nS} para que sea par.<br>`,
        `\\[
          = \\frac{${hS.toFixed(6)}}{3}
          \\left[
            ${fn(a).toFixed(8)} + ${fn(b).toFixed(8)}
            + (${Array.from({length:nS},(_,i)=>i)
                .filter(i=>i%2===1)
                .map(i=>`4(${fn(a+i*hS).toFixed(8)})`).join(" + ")})
            + (${Array.from({length:nS},(_,i)=>i)
                .filter(i=>i%2===0 && i!==0 && i!==nS)
                .map(i=>`2(${fn(a+i*hS).toFixed(8)})`).join(" + ")})
          \\right]
          = ${simpsonResult.toFixed(8)}
        \\]<br><br>`,

        `<b>Resultado final aproximado:</b><br>`,
        `\\[ \\text{Trapecio: } \\, ${trapResult.toFixed(8)} \\]`,
        `\\[ \\text{Simpson: } \\, ${simpsonResult.toFixed(8)} \\]`
      ];

      openTutorial('', steps);

      if (window.MathJax) MathJax.typesetPromise?.() || MathJax.typeset();

    } catch (e) {
      alert("Error en explicaci√≥n: " + e.message);
    }
  }

  /* -----------------------
    LOAD INTEGRATION CASE STUDY
    ----------------------- */
  function loadIntegrationCaseStudy() {
    // Carga los datos del caso de estudio de consumo energ√©tico
    document.getElementById('exprI').value = 'e^(0.1*x) + x^2';
    document.getElementById('a').value = '0';
    document.getElementById('b').value = '6';
    document.getElementById('n').value = '6';
    try {
      calcInt();
    } catch (e) {
      console.error("Error al cargar el caso de estudio de integraci√≥n:", e);
    }
  }

  /* -----------------------
    Init: set some sensible defaults
    ----------------------- */
  window.addEventListener('load', () => {
    // sensible defaults
    document.getElementById('exprD').value = 'sin(x)';
    document.getElementById('exprI').value = 'x^2+3*x';
    document.getElementById('a').value = '0';
    document.getElementById('b').value = '2';
    document.getElementById('n').value = '4';
    try { calcDeriv(); calcInt(); } catch (e) { /* ignore on first load */ }
  });

</script>

<script src="tutorial.js"></script>


  </body>
</html>
